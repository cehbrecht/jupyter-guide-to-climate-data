
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Regridding with xESMF &#8212; Jupyter Guide to Climate Data</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ESGF: Subset CMIP6 Datasets" href="esgf-subset-cmip6.html" />
    <link rel="prev" title="xarray" href="xarray.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Jupyter Guide to Climate Data</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Jupyter Guide to Climate Data
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="overview.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cdo.html">
   CDO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="xarray.html">
   xarray
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Regridding with xESMF
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="esgf-subset-cmip6.html">
   ESGF: Subset CMIP6 Datasets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="CDS.html">
   Copernicus Climate Data Store
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rooki-subset-cmip6.html">
   Rooki: run subset operation on remote service
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="PROV.html">
   Provenance Demo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="CLINT.html">
   CLINT - Climate Intelligence
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/cehbrecht/jupyter-guide-to-climate-data/main?urlpath=tree/Regrid_xESMF.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/Regrid_xESMF.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prepare-data">
   Prepare data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#input-data">
     Input data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#target-grid">
     Target grid
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#perform-regridding">
   Perform regridding
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-the-results">
   Plot the results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#masking">
   Masking
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-an-input-mask-to-obtain-a-better-result">
     Use an input mask to obtain a better result
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#instead-of-an-input-mask-apply-adaptive-masking">
     Instead of an input mask, apply adaptive masking
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regridding-of-the-global-dataset">
   Regridding of the global dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-examples">
   More Examples
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Regridding with xESMF</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prepare-data">
   Prepare data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#input-data">
     Input data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#target-grid">
     Target grid
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#perform-regridding">
   Perform regridding
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-the-results">
   Plot the results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#masking">
   Masking
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-an-input-mask-to-obtain-a-better-result">
     Use an input mask to obtain a better result
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#instead-of-an-input-mask-apply-adaptive-masking">
     Instead of an input mask, apply adaptive masking
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regridding-of-the-global-dataset">
   Regridding of the global dataset
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#more-examples">
   More Examples
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="regridding-with-xesmf">
<h1>Regridding with <a class="reference external" href="https://github.com/pangeo-data/xESMF">xESMF</a><a class="headerlink" href="#regridding-with-xesmf" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Some necessary steps when using a custom conda environment with pyproj and CDO installed</span>
<span class="kn">import</span> <span class="nn">conda</span><span class="o">,</span> <span class="nn">os</span>
<span class="n">conda_file_dir</span> <span class="o">=</span> <span class="n">conda</span><span class="o">.</span><span class="vm">__file__</span>
<span class="n">conda_dir</span> <span class="o">=</span> <span class="n">conda_file_dir</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;lib&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">proj_lib</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conda_dir</span><span class="p">,</span> <span class="s1">&#39;share&#39;</span><span class="p">),</span> <span class="s1">&#39;proj&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PROJ_LIB&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proj_lib</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;PATH&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">os</span><span class="o">.</span><span class="n">pathsep</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">conda_dir</span><span class="p">,</span> <span class="s1">&#39;bin&#39;</span><span class="p">)</span>

<span class="c1"># Import necessary python modules</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">xesmf</span> <span class="k">as</span> <span class="nn">xe</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">clisops.ops.subset</span> <span class="kn">import</span> <span class="n">subset</span>
</pre></div>
</div>
</div>
</div>
<section id="prepare-data">
<h2>Prepare data<a class="headerlink" href="#prepare-data" title="Permalink to this headline">#</a></h2>
<section id="input-data">
<h3>Input data<a class="headerlink" href="#input-data" title="Permalink to this headline">#</a></h3>
<p>We select two datasets:</p>
<ul class="simple">
<li><p>near surface air temperature (2D) on a rectilinear grid</p></li>
<li><p>sea surface temperature (2D) on a curvilinear grid</p></li>
</ul>
<p>Before creating the remapping weights, we subselect the region around Europe. For that we will use clisops,
since xarray cannot subset variables with 2D coordinate variables by their value. Also xarray cannot automatically wrap
longitude axis when subsetting across the 0-meridian (or in general: across the easter and western bounds of the grid).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">###########################################################################</span>
<span class="c1"># Specify input files, download if not working on levante, load via xarray:</span>
<span class="c1">###########################################################################</span>

<span class="n">cmip_root</span> <span class="o">=</span> <span class="s2">&quot;/work/ik1017/CMIP6/data&quot;</span>

<span class="c1"># near surface air temperature</span>
<span class="n">infile_tas</span> <span class="o">=</span> <span class="s2">&quot;tas_Amon_MPI-ESM1-2-HR_historical_r1i1p1f1_gn_185001-185412.nc&quot;</span>
<span class="n">path_tas</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cmip_root</span><span class="p">,</span>  
                <span class="s2">&quot;CMIP6/CMIP/MPI-M/MPI-ESM1-2-HR/historical/r1i1p1f1/Amon/tas/gn/v20190710&quot;</span><span class="p">,</span>
                <span class="n">infile_tas</span><span class="p">)</span>
<span class="n">ds_tas_global</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">path_tas</span><span class="p">)</span>

<span class="c1"># ocean surface temperature</span>
<span class="n">infile_tos</span> <span class="o">=</span> <span class="s2">&quot;tos_Omon_MPI-ESM1-2-HR_historical_r1i1p1f1_gn_185001-185412.nc&quot;</span>
<span class="n">path_tos</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cmip_root</span><span class="p">,</span>
                <span class="s2">&quot;CMIP6/CMIP/MPI-M/MPI-ESM1-2-HR/historical/r1i1p1f1/Omon/tos/gn/v20190710&quot;</span><span class="p">,</span>
                <span class="n">infile_tos</span><span class="p">)</span>
<span class="n">ds_tos_global</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">path_tos</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Subset near surface air temperature</span>
<span class="c1"># area is specified as a tuple (lon_lower, lat_lower, lon_upper, lat_upper)</span>
<span class="n">ds_tas</span> <span class="o">=</span> <span class="n">subset</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="n">ds_tas_global</span><span class="p">,</span> <span class="n">area</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">75</span><span class="p">),</span> <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;xarray&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Plot</span>
<span class="n">ds_tas</span><span class="o">.</span><span class="n">tas</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Regrid_xESMF_6_0.png" src="_images/Regrid_xESMF_6_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Subset sea surface temperature</span>
<span class="c1"># area is specified as a tuple (lon_lower, lat_lower, lon_upper, lat_upper)</span>
<span class="n">ds_tos</span> <span class="o">=</span> <span class="n">subset</span><span class="p">(</span><span class="n">ds</span><span class="o">=</span><span class="n">ds_tos_global</span><span class="p">,</span> <span class="n">area</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">75</span><span class="p">),</span> <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;xarray&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Plot</span>
<span class="n">ds_tos</span><span class="p">[</span><span class="s2">&quot;tos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
                                           <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">,</span> <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> 
                                           <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span><span class="mi">60</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span><span class="mi">75</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Regrid_xESMF_7_0.png" src="_images/Regrid_xESMF_7_0.png" />
</div>
</div>
</section>
<section id="target-grid">
<h3>Target grid<a class="headerlink" href="#target-grid" title="Permalink to this headline">#</a></h3>
<p>We use xESMF to create a regular Grid with <code class="docutils literal notranslate"><span class="pre">1.0°x1.0°</span></code> resolution.
A little smaller domain is selected for the output,
to avoid problems like missing values at the domain bounds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a regional regular latitude longitude grid of 1 degree resolution</span>
<span class="c1">#  xe.util.cf_grid_2d(lon0_b, lon1_b, d_lon, lat0_b, lat1_b, d_lat)</span>
<span class="n">ds_out</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">cf_grid_2d</span><span class="p">(</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># alternatively create a global target grid:</span>
<span class="c1">#ds_out = xe.util.grid_global(d_lat=1, d_lon=1, cf=True)</span>

<span class="c1"># altneratively use clisops to create the target grid:</span>
<span class="c1">#from clisops.core.regrid import Grid</span>
<span class="c1">#ds_out = Grid(grid_instructor=(-25,60,1,35,70,1)).ds</span>
<span class="c1">#ds_out = Grid(grid_instructor=1)</span>
<span class="c1">#ds_out = Grid(grid_id=&quot;1deg&quot;).ds</span>

<span class="c1"># display ds_out</span>
<span class="n">ds_out</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:             (bound: 2, lon: 85, lat: 35)
Coordinates:
  * lon                 (lon) float64 -24.5 -23.5 -22.5 -21.5 ... 57.5 58.5 59.5
  * lat                 (lat) float64 35.5 36.5 37.5 38.5 ... 67.5 68.5 69.5
    latitude_longitude  float64 nan
Dimensions without coordinates: bound
Data variables:
    lon_bounds          (bound, lon) int64 -25 -24 -23 -22 -21 ... 57 58 59 60
    lat_bounds          (bound, lat) int64 35 36 37 38 39 40 ... 66 67 68 69 70</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-ec200f74-61b9-41e2-9428-bd7eedbc57c5' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-ec200f74-61b9-41e2-9428-bd7eedbc57c5' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span>bound</span>: 2</li><li><span class='xr-has-index'>lon</span>: 85</li><li><span class='xr-has-index'>lat</span>: 35</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-734f6814-befc-4138-9d5c-0eb5cc6bbd98' class='xr-section-summary-in' type='checkbox'  checked><label for='section-734f6814-befc-4138-9d5c-0eb5cc6bbd98' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lon</span></div><div class='xr-var-dims'>(lon)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>-24.5 -23.5 -22.5 ... 58.5 59.5</div><input id='attrs-c5eb2426-ac68-42a1-b2f3-39b7c18c8a1e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-c5eb2426-ac68-42a1-b2f3-39b7c18c8a1e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e1b84fc9-a4bb-4b51-9b7d-ddf157b8b3cd' class='xr-var-data-in' type='checkbox'><label for='data-e1b84fc9-a4bb-4b51-9b7d-ddf157b8b3cd' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>bounds :</span></dt><dd>lon_bounds</dd><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><pre>array([-24.5, -23.5, -22.5, -21.5, -20.5, -19.5, -18.5, -17.5, -16.5, -15.5,
       -14.5, -13.5, -12.5, -11.5, -10.5,  -9.5,  -8.5,  -7.5,  -6.5,  -5.5,
        -4.5,  -3.5,  -2.5,  -1.5,  -0.5,   0.5,   1.5,   2.5,   3.5,   4.5,
         5.5,   6.5,   7.5,   8.5,   9.5,  10.5,  11.5,  12.5,  13.5,  14.5,
        15.5,  16.5,  17.5,  18.5,  19.5,  20.5,  21.5,  22.5,  23.5,  24.5,
        25.5,  26.5,  27.5,  28.5,  29.5,  30.5,  31.5,  32.5,  33.5,  34.5,
        35.5,  36.5,  37.5,  38.5,  39.5,  40.5,  41.5,  42.5,  43.5,  44.5,
        45.5,  46.5,  47.5,  48.5,  49.5,  50.5,  51.5,  52.5,  53.5,  54.5,
        55.5,  56.5,  57.5,  58.5,  59.5])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>lat</span></div><div class='xr-var-dims'>(lat)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>35.5 36.5 37.5 ... 67.5 68.5 69.5</div><input id='attrs-8d951ee5-b14c-40d0-acac-156719e7d6f1' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-8d951ee5-b14c-40d0-acac-156719e7d6f1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4b89377f-b147-4e0b-840e-9c72acc94eb5' class='xr-var-data-in' type='checkbox'><label for='data-4b89377f-b147-4e0b-840e-9c72acc94eb5' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>bounds :</span></dt><dd>lat_bounds</dd><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>array([35.5, 36.5, 37.5, 38.5, 39.5, 40.5, 41.5, 42.5, 43.5, 44.5, 45.5, 46.5,
       47.5, 48.5, 49.5, 50.5, 51.5, 52.5, 53.5, 54.5, 55.5, 56.5, 57.5, 58.5,
       59.5, 60.5, 61.5, 62.5, 63.5, 64.5, 65.5, 66.5, 67.5, 68.5, 69.5])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>latitude_longitude</span></div><div class='xr-var-dims'>()</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>nan</div><input id='attrs-4e686d90-9569-40f4-87f8-972c284a2730' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-4e686d90-9569-40f4-87f8-972c284a2730' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-0b4cfa90-91a4-46e5-8be6-f59b6b66fd77' class='xr-var-data-in' type='checkbox'><label for='data-0b4cfa90-91a4-46e5-8be6-f59b6b66fd77' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array(nan)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-1d6997ed-1186-4965-951a-bbe5a5d7f96a' class='xr-section-summary-in' type='checkbox'  checked><label for='section-1d6997ed-1186-4965-951a-bbe5a5d7f96a' class='xr-section-summary' >Data variables: <span>(2)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>lon_bounds</span></div><div class='xr-var-dims'>(bound, lon)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>-25 -24 -23 -22 -21 ... 57 58 59 60</div><input id='attrs-a94a4203-8031-4881-853c-2dcd9b76dd96' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-a94a4203-8031-4881-853c-2dcd9b76dd96' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-66ca5752-2646-4421-81d5-fb5e5adcdcb3' class='xr-var-data-in' type='checkbox'><label for='data-66ca5752-2646-4421-81d5-fb5e5adcdcb3' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[-25, -24, -23, -22, -21, -20, -19, -18, -17, -16, -15, -14, -13,
        -12, -11, -10,  -9,  -8,  -7,  -6,  -5,  -4,  -3,  -2,  -1,   0,
          1,   2,   3,   4,   5,   6,   7,   8,   9,  10,  11,  12,  13,
         14,  15,  16,  17,  18,  19,  20,  21,  22,  23,  24,  25,  26,
         27,  28,  29,  30,  31,  32,  33,  34,  35,  36,  37,  38,  39,
         40,  41,  42,  43,  44,  45,  46,  47,  48,  49,  50,  51,  52,
         53,  54,  55,  56,  57,  58,  59],
       [-24, -23, -22, -21, -20, -19, -18, -17, -16, -15, -14, -13, -12,
        -11, -10,  -9,  -8,  -7,  -6,  -5,  -4,  -3,  -2,  -1,   0,   1,
          2,   3,   4,   5,   6,   7,   8,   9,  10,  11,  12,  13,  14,
         15,  16,  17,  18,  19,  20,  21,  22,  23,  24,  25,  26,  27,
         28,  29,  30,  31,  32,  33,  34,  35,  36,  37,  38,  39,  40,
         41,  42,  43,  44,  45,  46,  47,  48,  49,  50,  51,  52,  53,
         54,  55,  56,  57,  58,  59,  60]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>lat_bounds</span></div><div class='xr-var-dims'>(bound, lat)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>35 36 37 38 39 ... 66 67 68 69 70</div><input id='attrs-989a82c0-2b7e-4bbc-a5d5-61092ebf6e3a' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-989a82c0-2b7e-4bbc-a5d5-61092ebf6e3a' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-dbaf290a-cf9a-40ef-9436-54f5d08c4a77' class='xr-var-data-in' type='checkbox'><label for='data-dbaf290a-cf9a-40ef-9436-54f5d08c4a77' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50,
        51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66,
        67, 68, 69],
       [36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51,
        52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67,
        68, 69, 70]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-b1f7c6c2-6c98-4c21-9b69-03f46cea545b' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-b1f7c6c2-6c98-4c21-9b69-03f46cea545b' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div></div></div>
</div>
</section>
</section>
<section id="perform-regridding">
<h2>Perform regridding<a class="headerlink" href="#perform-regridding" title="Permalink to this headline">#</a></h2>
<p>We create the regridding weights by calling <code class="docutils literal notranslate"><span class="pre">xe.Regridder(grid_in,</span> <span class="pre">grid_out,</span> <span class="pre">method)</span></code>. A <code class="docutils literal notranslate"><span class="pre">grid</span></code> is just an
xarray <code class="docutils literal notranslate"><span class="pre">DataSet</span></code> containing <code class="docutils literal notranslate"><span class="pre">latitude</span></code> and <code class="docutils literal notranslate"><span class="pre">longitude</span></code> coordinates.</p>
<p>xESMF supports multiple remapping methods, but <a class="reference external" href="https://climatedataguide.ucar.edu/climate-data-tools-and-analysis/regridding-overview">which method should be applied for the problem</a>?</p>
<table style="align:left !important; margin-left:0 !important;">
<thead>
  <tr>
    <th >Method</th>
    <th >Description</th>
    <th >Application</th>
  </tr>
</thead>
<tbody>
  <tr>
    <td>bilinear</td>
    <td><ul><li>linear interpolation</li><li>monotonic (i.e. creates no new maxima/minima)</li></ul></td>
    <td>smoothly varying variables (eg. temperature)</td>
  </tr>
  <tr>
    <td>conservative</td>
    <td><ul><li>preserving area average</li><li>maintaining eg. energy budgets</li><li>monotonic</li></ul></td>
    <td><ul><li>discontinuous variables / fluxes</li><li>upscaling (remapping to coarser grid)</li></ul> </td>
  </tr>
  <tr>
    <td>nearest neighbour</td>
    <td>monotonic</td>
    <td>categorical data (eg. binary masks, land usage type)</td>
  </tr>
  <tr>
    <td>patch</td>
      <td><ul><li>least square fit of surrounding surface patches</li><li>preserving derivatives<li</td>
    <td>eg. wind speed</td>
  </tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculation of weights, using xesmf.Regridder</span>
<span class="n">method_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;bilinear&quot;</span><span class="p">,</span>
               <span class="s2">&quot;conservative&quot;</span><span class="p">,</span>
               <span class="s2">&quot;conservative_normed&quot;</span><span class="p">,</span>
               <span class="s2">&quot;patch&quot;</span><span class="p">,</span>
               <span class="s2">&quot;nearest_s2d&quot;</span><span class="p">,</span>
               <span class="s2">&quot;nearest_d2s&quot;</span><span class="p">]</span>

<span class="n">regridder</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">method_list</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">method</span><span class="p">)</span>
    <span class="o">%</span><span class="k">time</span> regridder[method+&quot;_tas&quot;] = xe.Regridder(ds_tas, ds_out, method)
    <span class="o">%</span><span class="k">time</span> regridder[method+&quot;_tos&quot;] = xe.Regridder(ds_tos, ds_out, method)
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>bilinear
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 90.3 ms, sys: 62.5 ms, total: 153 ms
Wall time: 313 ms
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/work/bm0021/conda-envs-public/summerschool_2022/lib/python3.10/site-packages/xesmf/backend.py:38: UserWarning: Input array is not F_CONTIGUOUS. Will affect performance.
  warnings.warn(&#39;Input array is not F_CONTIGUOUS. &#39; &#39;Will affect performance.&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 206 ms, sys: 5.41 ms, total: 212 ms
Wall time: 214 ms

conservative
CPU times: user 193 ms, sys: 0 ns, total: 193 ms
Wall time: 194 ms
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 402 ms, sys: 2.75 ms, total: 405 ms
Wall time: 407 ms

conservative_normed
CPU times: user 161 ms, sys: 390 µs, total: 161 ms
Wall time: 162 ms
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 428 ms, sys: 186 µs, total: 428 ms
Wall time: 430 ms

patch
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 947 ms, sys: 0 ns, total: 947 ms
Wall time: 951 ms
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1.04 s, sys: 0 ns, total: 1.04 s
Wall time: 1.04 s

nearest_s2d
CPU times: user 14.9 ms, sys: 0 ns, total: 14.9 ms
Wall time: 15.8 ms
CPU times: user 41.8 ms, sys: 0 ns, total: 41.8 ms
Wall time: 41.9 ms

nearest_d2s
CPU times: user 22.2 ms, sys: 0 ns, total: 22.2 ms
Wall time: 22.3 ms
CPU times: user 101 ms, sys: 0 ns, total: 101 ms
Wall time: 101 ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Applying the weights to remap the data</span>
<span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">method_list</span><span class="p">:</span>
    <span class="n">ds_out</span><span class="p">[</span><span class="n">method</span><span class="o">+</span><span class="s2">&quot;_tas&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regridder</span><span class="p">[</span><span class="n">method</span><span class="o">+</span><span class="s2">&quot;_tas&quot;</span><span class="p">](</span><span class="n">ds_tas</span><span class="o">.</span><span class="n">tas</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">ds_out</span><span class="p">[</span><span class="n">method</span><span class="o">+</span><span class="s2">&quot;_tos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regridder</span><span class="p">[</span><span class="n">method</span><span class="o">+</span><span class="s2">&quot;_tos&quot;</span><span class="p">](</span><span class="n">ds_tos</span><span class="o">.</span><span class="n">tos</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/work/bm0021/conda-envs-public/summerschool_2022/lib/python3.10/site-packages/xesmf/smm.py:130: UserWarning: Input array is not C_CONTIGUOUS. Will affect performance.
  warnings.warn(&#39;Input array is not C_CONTIGUOUS. &#39; &#39;Will affect performance.&#39;)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/work/bm0021/conda-envs-public/summerschool_2022/lib/python3.10/site-packages/xesmf/smm.py:130: UserWarning: Input array is not C_CONTIGUOUS. Will affect performance.
  warnings.warn(&#39;Input array is not C_CONTIGUOUS. &#39; &#39;Will affect performance.&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-the-results">
<h2>Plot the results<a class="headerlink" href="#plot-the-results" title="Permalink to this headline">#</a></h2>
<p>The regridding result is consistent with the original data, with a much finer
resolution:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">method_list</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ds_out</span><span class="p">[</span><span class="n">method</span><span class="o">+</span><span class="s2">&quot;_tas&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Regrid_xESMF_16_0.png" src="_images/Regrid_xESMF_16_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">method_list</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ds_out</span><span class="p">[</span><span class="n">method</span><span class="o">+</span><span class="s2">&quot;_tos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Regrid_xESMF_17_0.png" src="_images/Regrid_xESMF_17_0.png" />
</div>
</div>
<ul class="simple">
<li><p>The missing values of the land cells are contaminating the result, since a target cell will get a missing value
as long as only a single contributing cell of the source grid has a missing value.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nearest_s2d</span></code> maps each cell of the target grid to one cell of the source grid.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nearest_d2s</span></code> maps each cell of the source grid to a cell of the target grid. In case of multiple matches, which is usually the case for upscaling, the values will be added up.</p></li>
</ul>
</section>
<section id="masking">
<h2>Masking<a class="headerlink" href="#masking" title="Permalink to this headline">#</a></h2>
<section id="use-an-input-mask-to-obtain-a-better-result">
<h3>Use an input mask to obtain a better result<a class="headerlink" href="#use-an-input-mask-to-obtain-a-better-result" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the mask - it has to be labeled &quot;mask&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">ds_tos</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ds_tos</span><span class="p">[</span><span class="s2">&quot;tos&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ds_tos</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
                               <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span><span class="mi">60</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span><span class="mi">75</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Regrid_xESMF_20_0.png" src="_images/Regrid_xESMF_20_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the weights</span>
<span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">method_list</span><span class="p">:</span>
    <span class="n">regridder</span><span class="p">[</span><span class="n">method</span><span class="o">+</span><span class="s2">&quot;_tos_mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span><span class="n">ds_tos</span><span class="p">,</span> <span class="n">ds_out</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/work/bm0021/conda-envs-public/summerschool_2022/lib/python3.10/site-packages/xesmf/backend.py:38: UserWarning: Input array is not F_CONTIGUOUS. Will affect performance.
  warnings.warn(&#39;Input array is not F_CONTIGUOUS. &#39; &#39;Will affect performance.&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Regrid the data</span>
<span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">method_list</span><span class="p">:</span>
    <span class="n">ds_out</span><span class="p">[</span><span class="n">method</span><span class="o">+</span><span class="s2">&quot;_tos_mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regridder</span><span class="p">[</span><span class="n">method</span><span class="o">+</span><span class="s2">&quot;_tos_mask&quot;</span><span class="p">](</span><span class="n">ds_tos</span><span class="o">.</span><span class="n">tos</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">method_list</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ds_out</span><span class="p">[</span><span class="n">method</span><span class="o">+</span><span class="s2">&quot;_tos_mask&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Regrid_xESMF_23_0.png" src="_images/Regrid_xESMF_23_0.png" />
</div>
</div>
<ul class="simple">
<li><p>conservative: the values near the coastline are too low since masked cells contribute to the area average with value 0</p></li>
<li><p>conservative_normed: here a renormalization is performed for these cells</p></li>
<li><p>nearest_s2d: cells on land have the same value as the closest unmasked source grid cell</p></li>
</ul>
</section>
<section id="instead-of-an-input-mask-apply-adaptive-masking">
<h3>Instead of an input mask, apply adaptive masking<a class="headerlink" href="#instead-of-an-input-mask-apply-adaptive-masking" title="Permalink to this headline">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">skipna</span></code> parameter (boolean, default: False) will cause cells with missing values to be ignored.
Additionally, a renormalization is conducted. Adaptive masking has no effect for the nearest neighbour remapping methods.</p>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">na_thres</span></code> (numeric, default: 1.0)
allows to specify a maximum ratio of occuring missing values, up to which to apply this <em>adaptive masking</em> technique.
If set to 1.0, no target grid cell that has any contribution of a souce grid cell will be set to missing_value. In rare cases this can lead to weird results for single cells with the bilinear and patch remapping methods.
If set to 0.0, the target grid cell will be set to missing_value if any contributing cell of the source grid is missing.</p>
<p>A big advantage over the input mask approach is, that weights can be reused for input data on the same grid if it is masked differently
(eg. 3D ocean data with the land sea mask varying with depth, 3D atmospheric data with orography varying with height, time dependent masks, …).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># We reuse the weights created above and store the remapped datasets in the same output dataset</span>
<span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">method_list</span><span class="p">:</span>
    <span class="n">ds_out</span><span class="p">[</span><span class="n">method</span><span class="o">+</span><span class="s2">&quot;_tos_skipna&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regridder</span><span class="p">[</span><span class="n">method</span><span class="o">+</span><span class="s2">&quot;_tos&quot;</span><span class="p">](</span><span class="n">ds_tos</span><span class="o">.</span><span class="n">tos</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">na_thres</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">method_list</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ds_out</span><span class="p">[</span><span class="n">method</span><span class="o">+</span><span class="s2">&quot;_tos_skipna&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Regrid_xESMF_27_0.png" src="_images/Regrid_xESMF_27_0.png" />
</div>
</div>
<p>The adaptive masking technique is best applied for the conservative and patch remapping methods,
especially when upscaling (remapping to a coarser grid).</p>
<p>If <code class="docutils literal notranslate"><span class="pre">skipna=True,</span> <span class="pre">na_thres=1.0</span></code> are set, the conservative method yields the same result as the conservative_normed method
with a defined input mask.</p>
</section>
</section>
<section id="regridding-of-the-global-dataset">
<h2>Regridding of the global dataset<a class="headerlink" href="#regridding-of-the-global-dataset" title="Permalink to this headline">#</a></h2>
<p>If you tried to remap the global sea surface temperature dataset you will have noticed that the weights generation
is not possible for most of the methods. This is because the dataset still contains the grid halo,
which are duplicated rows or columns at the edge of the grid, which are necessary during the model simulation, but not so much
in the final data product. On top of that, many grid halos have collapsing bounds (i.e. collapsing on a line or point) and this
causes (x)ESMF to crash when calculating the weights.</p>
<p>The CDO operator <code class="docutils literal notranslate"><span class="pre">verifygrid</span></code> is very useful in detecting duplicated and collapsing cells.</p>
<p>The xESMF Regridder features the parameter <code class="docutils literal notranslate"><span class="pre">ignore_degenerate</span></code> to deal with collapsing cells, but when using the patch or conservative methods,
the halo would still distort the results, since the halo cells are added up.
One can use xarray to remove the halo or the input mask option of xESMF to mask the halo (see eg. <a class="reference external" href="https://nbviewer.jupyter.org/github/roocs/regrid-prototype/blob/main/docs/notebooks/xESMF_Behaviour_Halo.ipynb">this notebook</a> ).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display the dataset</span>
<span class="n">ds_tos_global</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:             (time: 60, bnds: 2, j: 404, i: 802, vertices: 4)
Coordinates:
  * time                (time) datetime64[ns] 1850-01-16T12:00:00 ... 1854-12...
  * j                   (j) int32 0 1 2 3 4 5 6 ... 397 398 399 400 401 402 403
  * i                   (i) int32 0 1 2 3 4 5 6 ... 795 796 797 798 799 800 801
    latitude            (j, i) float64 51.15 51.15 51.15 ... -78.67 -78.67
    longitude           (j, i) float64 83.1 83.06 83.01 ... 82.4 82.85 83.3
Dimensions without coordinates: bnds, vertices
Data variables:
    time_bnds           (time, bnds) datetime64[ns] 1850-01-01 ... 1855-01-01
    vertices_latitude   (j, i, vertices) float64 ...
    vertices_longitude  (j, i, vertices) float64 ...
    tos                 (time, j, i) float32 ...
Attributes: (12/47)
    Conventions:            CF-1.7 CMIP-6.2
    activity_id:            CMIP
    branch_method:          standard
    branch_time_in_child:   0.0
    branch_time_in_parent:  0.0
    contact:                cmip6-mpi-esm@dkrz.de
    ...                     ...
    title:                  MPI-ESM1-2-HR output prepared for CMIP6
    variable_id:            tos
    variant_label:          r1i1p1f1
    license:                CMIP6 model data produced by MPI-M is licensed un...
    cmor_version:           3.5.0
    tracking_id:            hdl:21.14100/ccd8388f-4f80-4a1e-ba47-66fe65bbeece</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-0277edc1-1ffc-46ac-8177-9d18b785bfa7' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-0277edc1-1ffc-46ac-8177-9d18b785bfa7' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 60</li><li><span>bnds</span>: 2</li><li><span class='xr-has-index'>j</span>: 404</li><li><span class='xr-has-index'>i</span>: 802</li><li><span>vertices</span>: 4</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-58a9120a-ae8b-4aae-a698-ad524b8a4464' class='xr-section-summary-in' type='checkbox'  checked><label for='section-58a9120a-ae8b-4aae-a698-ad524b8a4464' class='xr-section-summary' >Coordinates: <span>(5)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1850-01-16T12:00:00 ... 1854-12-...</div><input id='attrs-8a814e96-fcb7-4895-8d30-5f0688a55c7d' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-8a814e96-fcb7-4895-8d30-5f0688a55c7d' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-733c2a34-319a-442b-882f-fc6b2e3a3b64' class='xr-var-data-in' type='checkbox'><label for='data-733c2a34-319a-442b-882f-fc6b2e3a3b64' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>bounds :</span></dt><dd>time_bnds</dd><dt><span>axis :</span></dt><dd>T</dd><dt><span>long_name :</span></dt><dd>time</dd><dt><span>standard_name :</span></dt><dd>time</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;1850-01-16T12:00:00.000000000&#x27;, &#x27;1850-02-15T00:00:00.000000000&#x27;,
       &#x27;1850-03-16T12:00:00.000000000&#x27;, &#x27;1850-04-16T00:00:00.000000000&#x27;,
       &#x27;1850-05-16T12:00:00.000000000&#x27;, &#x27;1850-06-16T00:00:00.000000000&#x27;,
       &#x27;1850-07-16T12:00:00.000000000&#x27;, &#x27;1850-08-16T12:00:00.000000000&#x27;,
       &#x27;1850-09-16T00:00:00.000000000&#x27;, &#x27;1850-10-16T12:00:00.000000000&#x27;,
       &#x27;1850-11-16T00:00:00.000000000&#x27;, &#x27;1850-12-16T12:00:00.000000000&#x27;,
       &#x27;1851-01-16T12:00:00.000000000&#x27;, &#x27;1851-02-15T00:00:00.000000000&#x27;,
       &#x27;1851-03-16T12:00:00.000000000&#x27;, &#x27;1851-04-16T00:00:00.000000000&#x27;,
       &#x27;1851-05-16T12:00:00.000000000&#x27;, &#x27;1851-06-16T00:00:00.000000000&#x27;,
       &#x27;1851-07-16T12:00:00.000000000&#x27;, &#x27;1851-08-16T12:00:00.000000000&#x27;,
       &#x27;1851-09-16T00:00:00.000000000&#x27;, &#x27;1851-10-16T12:00:00.000000000&#x27;,
       &#x27;1851-11-16T00:00:00.000000000&#x27;, &#x27;1851-12-16T12:00:00.000000000&#x27;,
       &#x27;1852-01-16T12:00:00.000000000&#x27;, &#x27;1852-02-15T12:00:00.000000000&#x27;,
       &#x27;1852-03-16T12:00:00.000000000&#x27;, &#x27;1852-04-16T00:00:00.000000000&#x27;,
       &#x27;1852-05-16T12:00:00.000000000&#x27;, &#x27;1852-06-16T00:00:00.000000000&#x27;,
       &#x27;1852-07-16T12:00:00.000000000&#x27;, &#x27;1852-08-16T12:00:00.000000000&#x27;,
       &#x27;1852-09-16T00:00:00.000000000&#x27;, &#x27;1852-10-16T12:00:00.000000000&#x27;,
       &#x27;1852-11-16T00:00:00.000000000&#x27;, &#x27;1852-12-16T12:00:00.000000000&#x27;,
       &#x27;1853-01-16T12:00:00.000000000&#x27;, &#x27;1853-02-15T00:00:00.000000000&#x27;,
       &#x27;1853-03-16T12:00:00.000000000&#x27;, &#x27;1853-04-16T00:00:00.000000000&#x27;,
       &#x27;1853-05-16T12:00:00.000000000&#x27;, &#x27;1853-06-16T00:00:00.000000000&#x27;,
       &#x27;1853-07-16T12:00:00.000000000&#x27;, &#x27;1853-08-16T12:00:00.000000000&#x27;,
       &#x27;1853-09-16T00:00:00.000000000&#x27;, &#x27;1853-10-16T12:00:00.000000000&#x27;,
       &#x27;1853-11-16T00:00:00.000000000&#x27;, &#x27;1853-12-16T12:00:00.000000000&#x27;,
       &#x27;1854-01-16T12:00:00.000000000&#x27;, &#x27;1854-02-15T00:00:00.000000000&#x27;,
       &#x27;1854-03-16T12:00:00.000000000&#x27;, &#x27;1854-04-16T00:00:00.000000000&#x27;,
       &#x27;1854-05-16T12:00:00.000000000&#x27;, &#x27;1854-06-16T00:00:00.000000000&#x27;,
       &#x27;1854-07-16T12:00:00.000000000&#x27;, &#x27;1854-08-16T12:00:00.000000000&#x27;,
       &#x27;1854-09-16T00:00:00.000000000&#x27;, &#x27;1854-10-16T12:00:00.000000000&#x27;,
       &#x27;1854-11-16T00:00:00.000000000&#x27;, &#x27;1854-12-16T12:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>j</span></div><div class='xr-var-dims'>(j)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 ... 399 400 401 402 403</div><input id='attrs-1457ff41-d7eb-472f-a701-39fc0668d5e0' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-1457ff41-d7eb-472f-a701-39fc0668d5e0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-9b0f68dc-cdc5-4ab2-ab5c-f60eb1b3310a' class='xr-var-data-in' type='checkbox'><label for='data-9b0f68dc-cdc5-4ab2-ab5c-f60eb1b3310a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>1</dd><dt><span>long_name :</span></dt><dd>cell index along second dimension</dd></dl></div><div class='xr-var-data'><pre>array([  0,   1,   2, ..., 401, 402, 403], dtype=int32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>i</span></div><div class='xr-var-dims'>(i)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>0 1 2 3 4 5 ... 797 798 799 800 801</div><input id='attrs-f1f2b628-2a82-44b3-ac41-9b7aa51b58f3' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f1f2b628-2a82-44b3-ac41-9b7aa51b58f3' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-1f04bd62-b8ae-4825-8cc0-d720822fbe94' class='xr-var-data-in' type='checkbox'><label for='data-1f04bd62-b8ae-4825-8cc0-d720822fbe94' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>1</dd><dt><span>long_name :</span></dt><dd>cell index along first dimension</dd></dl></div><div class='xr-var-data'><pre>array([  0,   1,   2, ..., 799, 800, 801], dtype=int32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>latitude</span></div><div class='xr-var-dims'>(j, i)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>51.15 51.15 51.15 ... -78.67 -78.67</div><input id='attrs-4c3fae70-77bf-4d5a-af3a-19eee5f94223' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-4c3fae70-77bf-4d5a-af3a-19eee5f94223' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ce22c3b3-9ffb-4ce4-8f77-c81cfed8d0cf' class='xr-var-data-in' type='checkbox'><label for='data-ce22c3b3-9ffb-4ce4-8f77-c81cfed8d0cf' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>long_name :</span></dt><dd>latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd><dt><span>bounds :</span></dt><dd>vertices_latitude</dd></dl></div><div class='xr-var-data'><pre>array([[ 51.148879,  51.148879,  51.149456, ...,  51.149456,  51.148879,
         51.148879],
       [ 51.245541,  51.245541,  51.24607 , ...,  51.24607 ,  51.245541,
         51.245541],
       [ 51.245541,  51.245541,  51.24607 , ...,  51.24607 ,  51.245541,
         51.245541],
       ...,
       [-77.891915, -77.891915, -77.89192 , ..., -77.89192 , -77.891915,
        -77.891915],
       [-78.283398, -78.283398, -78.283403, ..., -78.283403, -78.283398,
        -78.283398],
       [-78.674881, -78.674881, -78.674886, ..., -78.674886, -78.674881,
        -78.674881]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>longitude</span></div><div class='xr-var-dims'>(j, i)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>83.1 83.06 83.01 ... 82.85 83.3</div><input id='attrs-f1820d77-5d3f-4551-a196-46a464749b79' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f1820d77-5d3f-4551-a196-46a464749b79' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-8bddb6e1-37db-439e-a94a-05ba747bb277' class='xr-var-data-in' type='checkbox'><label for='data-8bddb6e1-37db-439e-a94a-05ba747bb277' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>long_name :</span></dt><dd>longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd><dt><span>bounds :</span></dt><dd>vertices_longitude</dd></dl></div><div class='xr-var-data'><pre>array([[83.10238 , 83.055381, 83.008324, ..., 83.149436, 83.10238 , 83.055381],
       [83.100889, 83.056872, 83.0128  , ..., 83.144961, 83.100889, 83.056872],
       [83.056872, 83.100889, 83.144961, ..., 83.0128  , 83.056872, 83.100889],
       ...,
       [82.85388 , 83.30388 , 83.75388 , ..., 82.40388 , 82.85388 , 83.30388 ],
       [82.85388 , 83.30388 , 83.75388 , ..., 82.40388 , 82.85388 , 83.30388 ],
       [82.85388 , 83.30388 , 83.75388 , ..., 82.40388 , 82.85388 , 83.30388 ]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-e7128954-919e-4362-89e5-e84e65c7f301' class='xr-section-summary-in' type='checkbox'  checked><label for='section-e7128954-919e-4362-89e5-e84e65c7f301' class='xr-section-summary' >Data variables: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>time_bnds</span></div><div class='xr-var-dims'>(time, bnds)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-e08693af-26c2-4856-bf48-26de9796333b' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-e08693af-26c2-4856-bf48-26de9796333b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-ae83e400-93f3-4703-b2ee-09faf4a374e4' class='xr-var-data-in' type='checkbox'><label for='data-ae83e400-93f3-4703-b2ee-09faf4a374e4' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[&#x27;1850-01-01T00:00:00.000000000&#x27;, &#x27;1850-02-01T00:00:00.000000000&#x27;],
       [&#x27;1850-02-01T00:00:00.000000000&#x27;, &#x27;1850-03-01T00:00:00.000000000&#x27;],
       [&#x27;1850-03-01T00:00:00.000000000&#x27;, &#x27;1850-04-01T00:00:00.000000000&#x27;],
       [&#x27;1850-04-01T00:00:00.000000000&#x27;, &#x27;1850-05-01T00:00:00.000000000&#x27;],
       [&#x27;1850-05-01T00:00:00.000000000&#x27;, &#x27;1850-06-01T00:00:00.000000000&#x27;],
       [&#x27;1850-06-01T00:00:00.000000000&#x27;, &#x27;1850-07-01T00:00:00.000000000&#x27;],
       [&#x27;1850-07-01T00:00:00.000000000&#x27;, &#x27;1850-08-01T00:00:00.000000000&#x27;],
       [&#x27;1850-08-01T00:00:00.000000000&#x27;, &#x27;1850-09-01T00:00:00.000000000&#x27;],
       [&#x27;1850-09-01T00:00:00.000000000&#x27;, &#x27;1850-10-01T00:00:00.000000000&#x27;],
       [&#x27;1850-10-01T00:00:00.000000000&#x27;, &#x27;1850-11-01T00:00:00.000000000&#x27;],
       [&#x27;1850-11-01T00:00:00.000000000&#x27;, &#x27;1850-12-01T00:00:00.000000000&#x27;],
       [&#x27;1850-12-01T00:00:00.000000000&#x27;, &#x27;1851-01-01T00:00:00.000000000&#x27;],
       [&#x27;1851-01-01T00:00:00.000000000&#x27;, &#x27;1851-02-01T00:00:00.000000000&#x27;],
       [&#x27;1851-02-01T00:00:00.000000000&#x27;, &#x27;1851-03-01T00:00:00.000000000&#x27;],
       [&#x27;1851-03-01T00:00:00.000000000&#x27;, &#x27;1851-04-01T00:00:00.000000000&#x27;],
       [&#x27;1851-04-01T00:00:00.000000000&#x27;, &#x27;1851-05-01T00:00:00.000000000&#x27;],
       [&#x27;1851-05-01T00:00:00.000000000&#x27;, &#x27;1851-06-01T00:00:00.000000000&#x27;],
       [&#x27;1851-06-01T00:00:00.000000000&#x27;, &#x27;1851-07-01T00:00:00.000000000&#x27;],
       [&#x27;1851-07-01T00:00:00.000000000&#x27;, &#x27;1851-08-01T00:00:00.000000000&#x27;],
       [&#x27;1851-08-01T00:00:00.000000000&#x27;, &#x27;1851-09-01T00:00:00.000000000&#x27;],
       [&#x27;1851-09-01T00:00:00.000000000&#x27;, &#x27;1851-10-01T00:00:00.000000000&#x27;],
       [&#x27;1851-10-01T00:00:00.000000000&#x27;, &#x27;1851-11-01T00:00:00.000000000&#x27;],
       [&#x27;1851-11-01T00:00:00.000000000&#x27;, &#x27;1851-12-01T00:00:00.000000000&#x27;],
       [&#x27;1851-12-01T00:00:00.000000000&#x27;, &#x27;1852-01-01T00:00:00.000000000&#x27;],
       [&#x27;1852-01-01T00:00:00.000000000&#x27;, &#x27;1852-02-01T00:00:00.000000000&#x27;],
       [&#x27;1852-02-01T00:00:00.000000000&#x27;, &#x27;1852-03-01T00:00:00.000000000&#x27;],
       [&#x27;1852-03-01T00:00:00.000000000&#x27;, &#x27;1852-04-01T00:00:00.000000000&#x27;],
       [&#x27;1852-04-01T00:00:00.000000000&#x27;, &#x27;1852-05-01T00:00:00.000000000&#x27;],
       [&#x27;1852-05-01T00:00:00.000000000&#x27;, &#x27;1852-06-01T00:00:00.000000000&#x27;],
       [&#x27;1852-06-01T00:00:00.000000000&#x27;, &#x27;1852-07-01T00:00:00.000000000&#x27;],
       [&#x27;1852-07-01T00:00:00.000000000&#x27;, &#x27;1852-08-01T00:00:00.000000000&#x27;],
       [&#x27;1852-08-01T00:00:00.000000000&#x27;, &#x27;1852-09-01T00:00:00.000000000&#x27;],
       [&#x27;1852-09-01T00:00:00.000000000&#x27;, &#x27;1852-10-01T00:00:00.000000000&#x27;],
       [&#x27;1852-10-01T00:00:00.000000000&#x27;, &#x27;1852-11-01T00:00:00.000000000&#x27;],
       [&#x27;1852-11-01T00:00:00.000000000&#x27;, &#x27;1852-12-01T00:00:00.000000000&#x27;],
       [&#x27;1852-12-01T00:00:00.000000000&#x27;, &#x27;1853-01-01T00:00:00.000000000&#x27;],
       [&#x27;1853-01-01T00:00:00.000000000&#x27;, &#x27;1853-02-01T00:00:00.000000000&#x27;],
       [&#x27;1853-02-01T00:00:00.000000000&#x27;, &#x27;1853-03-01T00:00:00.000000000&#x27;],
       [&#x27;1853-03-01T00:00:00.000000000&#x27;, &#x27;1853-04-01T00:00:00.000000000&#x27;],
       [&#x27;1853-04-01T00:00:00.000000000&#x27;, &#x27;1853-05-01T00:00:00.000000000&#x27;],
       [&#x27;1853-05-01T00:00:00.000000000&#x27;, &#x27;1853-06-01T00:00:00.000000000&#x27;],
       [&#x27;1853-06-01T00:00:00.000000000&#x27;, &#x27;1853-07-01T00:00:00.000000000&#x27;],
       [&#x27;1853-07-01T00:00:00.000000000&#x27;, &#x27;1853-08-01T00:00:00.000000000&#x27;],
       [&#x27;1853-08-01T00:00:00.000000000&#x27;, &#x27;1853-09-01T00:00:00.000000000&#x27;],
       [&#x27;1853-09-01T00:00:00.000000000&#x27;, &#x27;1853-10-01T00:00:00.000000000&#x27;],
       [&#x27;1853-10-01T00:00:00.000000000&#x27;, &#x27;1853-11-01T00:00:00.000000000&#x27;],
       [&#x27;1853-11-01T00:00:00.000000000&#x27;, &#x27;1853-12-01T00:00:00.000000000&#x27;],
       [&#x27;1853-12-01T00:00:00.000000000&#x27;, &#x27;1854-01-01T00:00:00.000000000&#x27;],
       [&#x27;1854-01-01T00:00:00.000000000&#x27;, &#x27;1854-02-01T00:00:00.000000000&#x27;],
       [&#x27;1854-02-01T00:00:00.000000000&#x27;, &#x27;1854-03-01T00:00:00.000000000&#x27;],
       [&#x27;1854-03-01T00:00:00.000000000&#x27;, &#x27;1854-04-01T00:00:00.000000000&#x27;],
       [&#x27;1854-04-01T00:00:00.000000000&#x27;, &#x27;1854-05-01T00:00:00.000000000&#x27;],
       [&#x27;1854-05-01T00:00:00.000000000&#x27;, &#x27;1854-06-01T00:00:00.000000000&#x27;],
       [&#x27;1854-06-01T00:00:00.000000000&#x27;, &#x27;1854-07-01T00:00:00.000000000&#x27;],
       [&#x27;1854-07-01T00:00:00.000000000&#x27;, &#x27;1854-08-01T00:00:00.000000000&#x27;],
       [&#x27;1854-08-01T00:00:00.000000000&#x27;, &#x27;1854-09-01T00:00:00.000000000&#x27;],
       [&#x27;1854-09-01T00:00:00.000000000&#x27;, &#x27;1854-10-01T00:00:00.000000000&#x27;],
       [&#x27;1854-10-01T00:00:00.000000000&#x27;, &#x27;1854-11-01T00:00:00.000000000&#x27;],
       [&#x27;1854-11-01T00:00:00.000000000&#x27;, &#x27;1854-12-01T00:00:00.000000000&#x27;],
       [&#x27;1854-12-01T00:00:00.000000000&#x27;, &#x27;1855-01-01T00:00:00.000000000&#x27;]],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>vertices_latitude</span></div><div class='xr-var-dims'>(j, i, vertices)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-60710ea1-633f-494d-9792-5a9435be05e0' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-60710ea1-633f-494d-9792-5a9435be05e0' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-980a4194-4a2c-48ce-9217-09268cc1bc08' class='xr-var-data-in' type='checkbox'><label for='data-980a4194-4a2c-48ce-9217-09268cc1bc08' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>[1296032 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>vertices_longitude</span></div><div class='xr-var-dims'>(j, i, vertices)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-dc3d1557-e411-4ccb-b9c6-4876312d040b' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-dc3d1557-e411-4ccb-b9c6-4876312d040b' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-15e58820-147d-4c37-9b0a-1f02d7ae151b' class='xr-var-data-in' type='checkbox'><label for='data-15e58820-147d-4c37-9b0a-1f02d7ae151b' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><pre>[1296032 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>tos</span></div><div class='xr-var-dims'>(time, j, i)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-9ef6b91b-ee2f-451e-9754-742f0537e231' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-9ef6b91b-ee2f-451e-9754-742f0537e231' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7eb97dc5-a700-401f-8230-fa1ab12f7842' class='xr-var-data-in' type='checkbox'><label for='data-7eb97dc5-a700-401f-8230-fa1ab12f7842' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>sea_surface_temperature</dd><dt><span>long_name :</span></dt><dd>Sea Surface Temperature</dd><dt><span>comment :</span></dt><dd>Temperature of upper boundary of the liquid ocean, including temperatures below sea-ice and floating ice shelves.</dd><dt><span>units :</span></dt><dd>degC</dd><dt><span>original_name :</span></dt><dd>tos</dd><dt><span>cell_methods :</span></dt><dd>area: mean where sea time: mean</dd><dt><span>cell_measures :</span></dt><dd>area: areacello</dd><dt><span>history :</span></dt><dd>2019-08-25T06:00:45Z altered by CMOR: replaced missing value flag (-9e+33) and corresponding data with standard missing value (1e+20).</dd></dl></div><div class='xr-var-data'><pre>[19440480 values with dtype=float32]</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-3ba21e15-1987-4281-b3be-231bf1be23ad' class='xr-section-summary-in' type='checkbox'  ><label for='section-3ba21e15-1987-4281-b3be-231bf1be23ad' class='xr-section-summary' >Attributes: <span>(47)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>Conventions :</span></dt><dd>CF-1.7 CMIP-6.2</dd><dt><span>activity_id :</span></dt><dd>CMIP</dd><dt><span>branch_method :</span></dt><dd>standard</dd><dt><span>branch_time_in_child :</span></dt><dd>0.0</dd><dt><span>branch_time_in_parent :</span></dt><dd>0.0</dd><dt><span>contact :</span></dt><dd>cmip6-mpi-esm@dkrz.de</dd><dt><span>creation_date :</span></dt><dd>2019-08-25T06:00:45Z</dd><dt><span>data_specs_version :</span></dt><dd>01.00.30</dd><dt><span>experiment :</span></dt><dd>all-forcing simulation of the recent past</dd><dt><span>experiment_id :</span></dt><dd>historical</dd><dt><span>external_variables :</span></dt><dd>areacello</dd><dt><span>forcing_index :</span></dt><dd>1</dd><dt><span>frequency :</span></dt><dd>mon</dd><dt><span>further_info_url :</span></dt><dd>https://furtherinfo.es-doc.org/CMIP6.MPI-M.MPI-ESM1-2-HR.historical.none.r1i1p1f1</dd><dt><span>grid :</span></dt><dd>gn</dd><dt><span>grid_label :</span></dt><dd>gn</dd><dt><span>history :</span></dt><dd>2019-08-25T06:00:45Z ; CMOR rewrote data to be consistent with CMIP6, CF-1.7 CMIP-6.2 and CF standards.</dd><dt><span>initialization_index :</span></dt><dd>1</dd><dt><span>institution :</span></dt><dd>Max Planck Institute for Meteorology, Hamburg 20146, Germany</dd><dt><span>institution_id :</span></dt><dd>MPI-M</dd><dt><span>mip_era :</span></dt><dd>CMIP6</dd><dt><span>nominal_resolution :</span></dt><dd>50 km</dd><dt><span>parent_activity_id :</span></dt><dd>CMIP</dd><dt><span>parent_experiment_id :</span></dt><dd>piControl</dd><dt><span>parent_mip_era :</span></dt><dd>CMIP6</dd><dt><span>parent_source_id :</span></dt><dd>MPI-ESM1-2-HR</dd><dt><span>parent_time_units :</span></dt><dd>days since 1850-1-1 00:00:00</dd><dt><span>parent_variant_label :</span></dt><dd>r1i1p1f1</dd><dt><span>physics_index :</span></dt><dd>1</dd><dt><span>product :</span></dt><dd>model-output</dd><dt><span>project_id :</span></dt><dd>CMIP6</dd><dt><span>realization_index :</span></dt><dd>1</dd><dt><span>realm :</span></dt><dd>ocean</dd><dt><span>references :</span></dt><dd>MPI-ESM: Mauritsen, T. et al. (2019), Developments in the MPI‐M Earth System Model version 1.2 (MPI‐ESM1.2) and Its Response to Increasing CO2, J. Adv. Model. Earth Syst.,11, 998-1038, doi:10.1029/2018MS001400,
Mueller, W.A. et al. (2018): A high‐resolution version of the Max Planck Institute Earth System Model MPI‐ESM1.2‐HR. J. Adv. Model. EarthSyst.,10,1383–1413, doi:10.1029/2017MS001217</dd><dt><span>source :</span></dt><dd>MPI-ESM1.2-HR (2017): 
aerosol: none, prescribed MACv2-SP
atmos: ECHAM6.3 (spectral T127; 384 x 192 longitude/latitude; 95 levels; top level 0.01 hPa)
atmosChem: none
land: JSBACH3.20
landIce: none/prescribed
ocean: MPIOM1.63 (tripolar TP04, approximately 0.4deg; 802 x 404 longitude/latitude; 40 levels; top grid cell 0-12 m)
ocnBgchem: HAMOCC6
seaIce: unnamed (thermodynamic (Semtner zero-layer) dynamic (Hibler 79) sea ice model)</dd><dt><span>source_id :</span></dt><dd>MPI-ESM1-2-HR</dd><dt><span>source_type :</span></dt><dd>AOGCM</dd><dt><span>sub_experiment :</span></dt><dd>none</dd><dt><span>sub_experiment_id :</span></dt><dd>none</dd><dt><span>table_id :</span></dt><dd>Omon</dd><dt><span>table_info :</span></dt><dd>Creation Date:(09 May 2019) MD5:e6ef8ececc8f338646ebfb3aeed36bfc</dd><dt><span>title :</span></dt><dd>MPI-ESM1-2-HR output prepared for CMIP6</dd><dt><span>variable_id :</span></dt><dd>tos</dd><dt><span>variant_label :</span></dt><dd>r1i1p1f1</dd><dt><span>license :</span></dt><dd>CMIP6 model data produced by MPI-M is licensed under a Creative Commons Attribution ShareAlike 4.0 International License (https://creativecommons.org/licenses). Consult https://pcmdi.llnl.gov/CMIP6/TermsOfUse for terms of use governing CMIP6 output, including citation requirements and proper acknowledgment. Further information about this data, including some limitations, can be found via the further_info_url (recorded as a global attribute in this file) and. The data producers and data providers make no warranty, either express or implied, including, but not limited to, warranties of merchantability and fitness for a particular purpose. All liabilities arising from the supply of the information (including any liability arising in negligence) are excluded to the fullest extent permitted by law.</dd><dt><span>cmor_version :</span></dt><dd>3.5.0</dd><dt><span>tracking_id :</span></dt><dd>hdl:21.14100/ccd8388f-4f80-4a1e-ba47-66fe65bbeece</dd></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Let us take a look at the grid, the halo can be spotted:</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">ds_tos_global</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">ds_tos_global</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.001</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Regrid_xESMF_31_0.png" src="_images/Regrid_xESMF_31_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use cdo verifygrid to confirm duplicated and/or collapsing cells</span>
<span class="o">!</span> cdo verifygrid <span class="o">{</span>path_tos<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">cdo    verifygrid: </span><span class=" -Color -Color-Blue">Grid consists of 324008 (802x404) cells (type: curvilinear), of which</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">cdo    verifygrid: </span><span class=" -Color -Color-Blue">   324008 cells have 4 vertices</span>
<span class=" -Color -Color-Green">cdo    verifygrid: </span><span class=" -Color -Color-Blue">      404 cells have duplicate vertices</span>
<span class=" -Color -Color-Green">cdo    verifygrid: </span><span class=" -Color -Color-Red">     2408 cells are not unique</span>
<span class=" -Color -Color-Green">cdo    verifygrid: </span><span class=" -Color -Color-Red">      404 cells are non-convex</span>
<span class=" -Color -Color-Green">cdo    verifygrid: </span><span class=" -Color -Color-Red">      884 cells have their center point located outside their boundaries</span>
<span class=" -Color -Color-Green">cdo    verifygrid: </span> longitude : 0.00591556 to 359.9989 degrees
<span class=" -Color -Color-Green">cdo    verifygrid: </span>  latitude : -78.71779 to 89.76312 degrees
<span class=" -Color -Color-Green">cdo    verifygrid: </span>Processed 1 variable [0.23s 321MB].
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The halo of the MPIOM GR15 grid (MPI-ESM1-2-LR) consists of the first and last column, </span>
<span class="c1">#  the halo of the MPIOM TP04 grid (MPI-ESM1-2-HR) consists of the first and last column as well as the first two rows</span>
<span class="c1">#  (in case it is not obvious as in the latter case, one would have to ask the modelers how their halo is defined ...)</span>
<span class="n">ds_tos_nohalo</span> <span class="o">=</span> <span class="n">ds_tos_global</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">801</span><span class="p">),</span> <span class="n">j</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">405</span><span class="p">))</span>
<span class="n">ds_tos_nohalo</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><svg style="position: absolute; width: 0; height: 0; overflow: hidden">
<defs>
<symbol id="icon-database" viewBox="0 0 32 32">
<path d="M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z"></path>
<path d="M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
<path d="M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z"></path>
</symbol>
<symbol id="icon-file-text2" viewBox="0 0 32 32">
<path d="M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z"></path>
<path d="M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
<path d="M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z"></path>
</symbol>
</defs>
</svg>
<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.
 *
 */

:root {
  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));
  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));
  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));
  --xr-border-color: var(--jp-border-color2, #e0e0e0);
  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);
  --xr-background-color: var(--jp-layout-color0, white);
  --xr-background-color-row-even: var(--jp-layout-color1, white);
  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);
}

html[theme=dark],
body.vscode-dark {
  --xr-font-color0: rgba(255, 255, 255, 1);
  --xr-font-color2: rgba(255, 255, 255, 0.54);
  --xr-font-color3: rgba(255, 255, 255, 0.38);
  --xr-border-color: #1F1F1F;
  --xr-disabled-color: #515151;
  --xr-background-color: #111111;
  --xr-background-color-row-even: #111111;
  --xr-background-color-row-odd: #313131;
}

.xr-wrap {
  display: block !important;
  min-width: 300px;
  max-width: 700px;
}

.xr-text-repr-fallback {
  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */
  display: none;
}

.xr-header {
  padding-top: 6px;
  padding-bottom: 6px;
  margin-bottom: 4px;
  border-bottom: solid 1px var(--xr-border-color);
}

.xr-header > div,
.xr-header > ul {
  display: inline;
  margin-top: 0;
  margin-bottom: 0;
}

.xr-obj-type,
.xr-array-name {
  margin-left: 2px;
  margin-right: 10px;
}

.xr-obj-type {
  color: var(--xr-font-color2);
}

.xr-sections {
  padding-left: 0 !important;
  display: grid;
  grid-template-columns: 150px auto auto 1fr 20px 20px;
}

.xr-section-item {
  display: contents;
}

.xr-section-item input {
  display: none;
}

.xr-section-item input + label {
  color: var(--xr-disabled-color);
}

.xr-section-item input:enabled + label {
  cursor: pointer;
  color: var(--xr-font-color2);
}

.xr-section-item input:enabled + label:hover {
  color: var(--xr-font-color0);
}

.xr-section-summary {
  grid-column: 1;
  color: var(--xr-font-color2);
  font-weight: 500;
}

.xr-section-summary > span {
  display: inline-block;
  padding-left: 0.5em;
}

.xr-section-summary-in:disabled + label {
  color: var(--xr-font-color2);
}

.xr-section-summary-in + label:before {
  display: inline-block;
  content: '►';
  font-size: 11px;
  width: 15px;
  text-align: center;
}

.xr-section-summary-in:disabled + label:before {
  color: var(--xr-disabled-color);
}

.xr-section-summary-in:checked + label:before {
  content: '▼';
}

.xr-section-summary-in:checked + label > span {
  display: none;
}

.xr-section-summary,
.xr-section-inline-details {
  padding-top: 4px;
  padding-bottom: 4px;
}

.xr-section-inline-details {
  grid-column: 2 / -1;
}

.xr-section-details {
  display: none;
  grid-column: 1 / -1;
  margin-bottom: 5px;
}

.xr-section-summary-in:checked ~ .xr-section-details {
  display: contents;
}

.xr-array-wrap {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: 20px auto;
}

.xr-array-wrap > label {
  grid-column: 1;
  vertical-align: top;
}

.xr-preview {
  color: var(--xr-font-color3);
}

.xr-array-preview,
.xr-array-data {
  padding: 0 5px !important;
  grid-column: 2;
}

.xr-array-data,
.xr-array-in:checked ~ .xr-array-preview {
  display: none;
}

.xr-array-in:checked ~ .xr-array-data,
.xr-array-preview {
  display: inline-block;
}

.xr-dim-list {
  display: inline-block !important;
  list-style: none;
  padding: 0 !important;
  margin: 0;
}

.xr-dim-list li {
  display: inline-block;
  padding: 0;
  margin: 0;
}

.xr-dim-list:before {
  content: '(';
}

.xr-dim-list:after {
  content: ')';
}

.xr-dim-list li:not(:last-child):after {
  content: ',';
  padding-right: 5px;
}

.xr-has-index {
  font-weight: bold;
}

.xr-var-list,
.xr-var-item {
  display: contents;
}

.xr-var-item > div,
.xr-var-item label,
.xr-var-item > .xr-var-name span {
  background-color: var(--xr-background-color-row-even);
  margin-bottom: 0;
}

.xr-var-item > .xr-var-name:hover span {
  padding-right: 5px;
}

.xr-var-list > li:nth-child(odd) > div,
.xr-var-list > li:nth-child(odd) > label,
.xr-var-list > li:nth-child(odd) > .xr-var-name span {
  background-color: var(--xr-background-color-row-odd);
}

.xr-var-name {
  grid-column: 1;
}

.xr-var-dims {
  grid-column: 2;
}

.xr-var-dtype {
  grid-column: 3;
  text-align: right;
  color: var(--xr-font-color2);
}

.xr-var-preview {
  grid-column: 4;
}

.xr-var-name,
.xr-var-dims,
.xr-var-dtype,
.xr-preview,
.xr-attrs dt {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding-right: 10px;
}

.xr-var-name:hover,
.xr-var-dims:hover,
.xr-var-dtype:hover,
.xr-attrs dt:hover {
  overflow: visible;
  width: auto;
  z-index: 1;
}

.xr-var-attrs,
.xr-var-data {
  display: none;
  background-color: var(--xr-background-color) !important;
  padding-bottom: 5px !important;
}

.xr-var-attrs-in:checked ~ .xr-var-attrs,
.xr-var-data-in:checked ~ .xr-var-data {
  display: block;
}

.xr-var-data > table {
  float: right;
}

.xr-var-name span,
.xr-var-data,
.xr-attrs {
  padding-left: 25px !important;
}

.xr-attrs,
.xr-var-attrs,
.xr-var-data {
  grid-column: 1 / -1;
}

dl.xr-attrs {
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: 125px auto;
}

.xr-attrs dt,
.xr-attrs dd {
  padding: 0;
  margin: 0;
  float: left;
  padding-right: 10px;
  width: auto;
}

.xr-attrs dt {
  font-weight: normal;
  grid-column: 1;
}

.xr-attrs dt:hover span {
  display: inline-block;
  background: var(--xr-background-color);
  padding-right: 10px;
}

.xr-attrs dd {
  grid-column: 2;
  white-space: pre-wrap;
  word-break: break-all;
}

.xr-icon-database,
.xr-icon-file-text2 {
  display: inline-block;
  vertical-align: middle;
  width: 1em;
  height: 1.5em !important;
  stroke-width: 0;
  stroke: currentColor;
  fill: currentColor;
}
</style><pre class='xr-text-repr-fallback'>&lt;xarray.Dataset&gt;
Dimensions:             (time: 60, bnds: 2, j: 402, i: 800, vertices: 4)
Coordinates:
  * time                (time) datetime64[ns] 1850-01-16T12:00:00 ... 1854-12...
  * j                   (j) int32 2 3 4 5 6 7 8 ... 397 398 399 400 401 402 403
  * i                   (i) int32 1 2 3 4 5 6 7 ... 794 795 796 797 798 799 800
    latitude            (j, i) float64 51.25 51.25 51.25 ... -78.67 -78.67
    longitude           (j, i) float64 83.1 83.14 83.19 ... 81.95 82.4 82.85
Dimensions without coordinates: bnds, vertices
Data variables:
    time_bnds           (time, bnds) datetime64[ns] 1850-01-01 ... 1855-01-01
    vertices_latitude   (j, i, vertices) float64 ...
    vertices_longitude  (j, i, vertices) float64 ...
    tos                 (time, j, i) float32 ...
Attributes: (12/47)
    Conventions:            CF-1.7 CMIP-6.2
    activity_id:            CMIP
    branch_method:          standard
    branch_time_in_child:   0.0
    branch_time_in_parent:  0.0
    contact:                cmip6-mpi-esm@dkrz.de
    ...                     ...
    title:                  MPI-ESM1-2-HR output prepared for CMIP6
    variable_id:            tos
    variant_label:          r1i1p1f1
    license:                CMIP6 model data produced by MPI-M is licensed un...
    cmor_version:           3.5.0
    tracking_id:            hdl:21.14100/ccd8388f-4f80-4a1e-ba47-66fe65bbeece</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.Dataset</div></div><ul class='xr-sections'><li class='xr-section-item'><input id='section-43460b0b-ba3c-4d84-844f-c9b1ad89f0c1' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-43460b0b-ba3c-4d84-844f-c9b1ad89f0c1' class='xr-section-summary'  title='Expand/collapse section'>Dimensions:</label><div class='xr-section-inline-details'><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 60</li><li><span>bnds</span>: 2</li><li><span class='xr-has-index'>j</span>: 402</li><li><span class='xr-has-index'>i</span>: 800</li><li><span>vertices</span>: 4</li></ul></div><div class='xr-section-details'></div></li><li class='xr-section-item'><input id='section-ddbc59f4-6f0e-4865-a958-faf62f0d1a4d' class='xr-section-summary-in' type='checkbox'  checked><label for='section-ddbc59f4-6f0e-4865-a958-faf62f0d1a4d' class='xr-section-summary' >Coordinates: <span>(5)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1850-01-16T12:00:00 ... 1854-12-...</div><input id='attrs-3ef452ff-b39c-4046-b88c-eac69d973bfe' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-3ef452ff-b39c-4046-b88c-eac69d973bfe' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-e15c3324-609c-450c-b31e-f77fe635b787' class='xr-var-data-in' type='checkbox'><label for='data-e15c3324-609c-450c-b31e-f77fe635b787' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>bounds :</span></dt><dd>time_bnds</dd><dt><span>axis :</span></dt><dd>T</dd><dt><span>long_name :</span></dt><dd>time</dd><dt><span>standard_name :</span></dt><dd>time</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;1850-01-16T12:00:00.000000000&#x27;, &#x27;1850-02-15T00:00:00.000000000&#x27;,
       &#x27;1850-03-16T12:00:00.000000000&#x27;, &#x27;1850-04-16T00:00:00.000000000&#x27;,
       &#x27;1850-05-16T12:00:00.000000000&#x27;, &#x27;1850-06-16T00:00:00.000000000&#x27;,
       &#x27;1850-07-16T12:00:00.000000000&#x27;, &#x27;1850-08-16T12:00:00.000000000&#x27;,
       &#x27;1850-09-16T00:00:00.000000000&#x27;, &#x27;1850-10-16T12:00:00.000000000&#x27;,
       &#x27;1850-11-16T00:00:00.000000000&#x27;, &#x27;1850-12-16T12:00:00.000000000&#x27;,
       &#x27;1851-01-16T12:00:00.000000000&#x27;, &#x27;1851-02-15T00:00:00.000000000&#x27;,
       &#x27;1851-03-16T12:00:00.000000000&#x27;, &#x27;1851-04-16T00:00:00.000000000&#x27;,
       &#x27;1851-05-16T12:00:00.000000000&#x27;, &#x27;1851-06-16T00:00:00.000000000&#x27;,
       &#x27;1851-07-16T12:00:00.000000000&#x27;, &#x27;1851-08-16T12:00:00.000000000&#x27;,
       &#x27;1851-09-16T00:00:00.000000000&#x27;, &#x27;1851-10-16T12:00:00.000000000&#x27;,
       &#x27;1851-11-16T00:00:00.000000000&#x27;, &#x27;1851-12-16T12:00:00.000000000&#x27;,
       &#x27;1852-01-16T12:00:00.000000000&#x27;, &#x27;1852-02-15T12:00:00.000000000&#x27;,
       &#x27;1852-03-16T12:00:00.000000000&#x27;, &#x27;1852-04-16T00:00:00.000000000&#x27;,
       &#x27;1852-05-16T12:00:00.000000000&#x27;, &#x27;1852-06-16T00:00:00.000000000&#x27;,
       &#x27;1852-07-16T12:00:00.000000000&#x27;, &#x27;1852-08-16T12:00:00.000000000&#x27;,
       &#x27;1852-09-16T00:00:00.000000000&#x27;, &#x27;1852-10-16T12:00:00.000000000&#x27;,
       &#x27;1852-11-16T00:00:00.000000000&#x27;, &#x27;1852-12-16T12:00:00.000000000&#x27;,
       &#x27;1853-01-16T12:00:00.000000000&#x27;, &#x27;1853-02-15T00:00:00.000000000&#x27;,
       &#x27;1853-03-16T12:00:00.000000000&#x27;, &#x27;1853-04-16T00:00:00.000000000&#x27;,
       &#x27;1853-05-16T12:00:00.000000000&#x27;, &#x27;1853-06-16T00:00:00.000000000&#x27;,
       &#x27;1853-07-16T12:00:00.000000000&#x27;, &#x27;1853-08-16T12:00:00.000000000&#x27;,
       &#x27;1853-09-16T00:00:00.000000000&#x27;, &#x27;1853-10-16T12:00:00.000000000&#x27;,
       &#x27;1853-11-16T00:00:00.000000000&#x27;, &#x27;1853-12-16T12:00:00.000000000&#x27;,
       &#x27;1854-01-16T12:00:00.000000000&#x27;, &#x27;1854-02-15T00:00:00.000000000&#x27;,
       &#x27;1854-03-16T12:00:00.000000000&#x27;, &#x27;1854-04-16T00:00:00.000000000&#x27;,
       &#x27;1854-05-16T12:00:00.000000000&#x27;, &#x27;1854-06-16T00:00:00.000000000&#x27;,
       &#x27;1854-07-16T12:00:00.000000000&#x27;, &#x27;1854-08-16T12:00:00.000000000&#x27;,
       &#x27;1854-09-16T00:00:00.000000000&#x27;, &#x27;1854-10-16T12:00:00.000000000&#x27;,
       &#x27;1854-11-16T00:00:00.000000000&#x27;, &#x27;1854-12-16T12:00:00.000000000&#x27;],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>j</span></div><div class='xr-var-dims'>(j)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>2 3 4 5 6 7 ... 399 400 401 402 403</div><input id='attrs-5f1e96b7-a006-45ae-a9de-316084fd20ae' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-5f1e96b7-a006-45ae-a9de-316084fd20ae' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bc39af58-bcc4-4a6c-8e5f-b17d80207b45' class='xr-var-data-in' type='checkbox'><label for='data-bc39af58-bcc4-4a6c-8e5f-b17d80207b45' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>1</dd><dt><span>long_name :</span></dt><dd>cell index along second dimension</dd></dl></div><div class='xr-var-data'><pre>array([  2,   3,   4, ..., 401, 402, 403], dtype=int32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>i</span></div><div class='xr-var-dims'>(i)</div><div class='xr-var-dtype'>int32</div><div class='xr-var-preview xr-preview'>1 2 3 4 5 6 ... 796 797 798 799 800</div><input id='attrs-55140e49-5af7-417b-bdfe-3bacbec9f60c' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-55140e49-5af7-417b-bdfe-3bacbec9f60c' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-7e5d8517-c92f-4466-b34c-32761e5f6ddd' class='xr-var-data-in' type='checkbox'><label for='data-7e5d8517-c92f-4466-b34c-32761e5f6ddd' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>1</dd><dt><span>long_name :</span></dt><dd>cell index along first dimension</dd></dl></div><div class='xr-var-data'><pre>array([  1,   2,   3, ..., 798, 799, 800], dtype=int32)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>latitude</span></div><div class='xr-var-dims'>(j, i)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>51.25 51.25 51.25 ... -78.67 -78.67</div><input id='attrs-aebd34f0-802e-4fae-9883-b1baebbc48ef' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-aebd34f0-802e-4fae-9883-b1baebbc48ef' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-5cb9b83c-df9e-47f8-abca-840e84a1e281' class='xr-var-data-in' type='checkbox'><label for='data-5cb9b83c-df9e-47f8-abca-840e84a1e281' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>latitude</dd><dt><span>long_name :</span></dt><dd>latitude</dd><dt><span>units :</span></dt><dd>degrees_north</dd><dt><span>bounds :</span></dt><dd>vertices_latitude</dd></dl></div><div class='xr-var-data'><pre>array([[ 51.245541,  51.24607 ,  51.247133, ...,  51.247133,  51.24607 ,
         51.245541],
       [ 51.148879,  51.149456,  51.150614, ...,  51.150614,  51.149456,
         51.148879],
       [ 51.052021,  51.052646,  51.053902, ...,  51.053902,  51.052646,
         51.052021],
       ...,
       [-77.891915, -77.89192 , -77.891931, ..., -77.891931, -77.89192 ,
        -77.891915],
       [-78.283398, -78.283403, -78.283414, ..., -78.283414, -78.283403,
        -78.283398],
       [-78.674881, -78.674886, -78.674897, ..., -78.674897, -78.674886,
        -78.674881]])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>longitude</span></div><div class='xr-var-dims'>(j, i)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>83.1 83.14 83.19 ... 82.4 82.85</div><input id='attrs-ec3d6135-eec9-4cb0-9998-0276cf3e861e' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-ec3d6135-eec9-4cb0-9998-0276cf3e861e' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2ee0f9c1-c73b-4fea-a773-f72fbcd9df4e' class='xr-var-data-in' type='checkbox'><label for='data-2ee0f9c1-c73b-4fea-a773-f72fbcd9df4e' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>longitude</dd><dt><span>long_name :</span></dt><dd>longitude</dd><dt><span>units :</span></dt><dd>degrees_east</dd><dt><span>bounds :</span></dt><dd>vertices_longitude</dd></dl></div><div class='xr-var-data'><pre>array([[83.100889, 83.144961, 83.189201, ..., 82.96856 , 83.0128  , 83.056872],
       [83.10238 , 83.149436, 83.196664, ..., 82.961096, 83.008324, 83.055381],
       [83.103897, 83.153989, 83.204257, ..., 82.953503, 83.003771, 83.053863],
       ...,
       [83.30388 , 83.75388 , 84.20388 , ..., 81.95388 , 82.40388 , 82.85388 ],
       [83.30388 , 83.75388 , 84.20388 , ..., 81.95388 , 82.40388 , 82.85388 ],
       [83.30388 , 83.75388 , 84.20388 , ..., 81.95388 , 82.40388 , 82.85388 ]])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-cd4e5c2b-5558-445c-bbd0-74bcc64017ab' class='xr-section-summary-in' type='checkbox'  checked><label for='section-cd4e5c2b-5558-445c-bbd0-74bcc64017ab' class='xr-section-summary' >Data variables: <span>(4)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span>time_bnds</span></div><div class='xr-var-dims'>(time, bnds)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>1850-01-01 ... 1855-01-01</div><input id='attrs-51740224-b340-420d-9234-30bb066479d1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-51740224-b340-420d-9234-30bb066479d1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-b04be13f-f977-4a26-841f-dcc039a2eb09' class='xr-var-data-in' type='checkbox'><label for='data-b04be13f-f977-4a26-841f-dcc039a2eb09' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([[&#x27;1850-01-01T00:00:00.000000000&#x27;, &#x27;1850-02-01T00:00:00.000000000&#x27;],
       [&#x27;1850-02-01T00:00:00.000000000&#x27;, &#x27;1850-03-01T00:00:00.000000000&#x27;],
       [&#x27;1850-03-01T00:00:00.000000000&#x27;, &#x27;1850-04-01T00:00:00.000000000&#x27;],
       [&#x27;1850-04-01T00:00:00.000000000&#x27;, &#x27;1850-05-01T00:00:00.000000000&#x27;],
       [&#x27;1850-05-01T00:00:00.000000000&#x27;, &#x27;1850-06-01T00:00:00.000000000&#x27;],
       [&#x27;1850-06-01T00:00:00.000000000&#x27;, &#x27;1850-07-01T00:00:00.000000000&#x27;],
       [&#x27;1850-07-01T00:00:00.000000000&#x27;, &#x27;1850-08-01T00:00:00.000000000&#x27;],
       [&#x27;1850-08-01T00:00:00.000000000&#x27;, &#x27;1850-09-01T00:00:00.000000000&#x27;],
       [&#x27;1850-09-01T00:00:00.000000000&#x27;, &#x27;1850-10-01T00:00:00.000000000&#x27;],
       [&#x27;1850-10-01T00:00:00.000000000&#x27;, &#x27;1850-11-01T00:00:00.000000000&#x27;],
       [&#x27;1850-11-01T00:00:00.000000000&#x27;, &#x27;1850-12-01T00:00:00.000000000&#x27;],
       [&#x27;1850-12-01T00:00:00.000000000&#x27;, &#x27;1851-01-01T00:00:00.000000000&#x27;],
       [&#x27;1851-01-01T00:00:00.000000000&#x27;, &#x27;1851-02-01T00:00:00.000000000&#x27;],
       [&#x27;1851-02-01T00:00:00.000000000&#x27;, &#x27;1851-03-01T00:00:00.000000000&#x27;],
       [&#x27;1851-03-01T00:00:00.000000000&#x27;, &#x27;1851-04-01T00:00:00.000000000&#x27;],
       [&#x27;1851-04-01T00:00:00.000000000&#x27;, &#x27;1851-05-01T00:00:00.000000000&#x27;],
       [&#x27;1851-05-01T00:00:00.000000000&#x27;, &#x27;1851-06-01T00:00:00.000000000&#x27;],
       [&#x27;1851-06-01T00:00:00.000000000&#x27;, &#x27;1851-07-01T00:00:00.000000000&#x27;],
       [&#x27;1851-07-01T00:00:00.000000000&#x27;, &#x27;1851-08-01T00:00:00.000000000&#x27;],
       [&#x27;1851-08-01T00:00:00.000000000&#x27;, &#x27;1851-09-01T00:00:00.000000000&#x27;],
       [&#x27;1851-09-01T00:00:00.000000000&#x27;, &#x27;1851-10-01T00:00:00.000000000&#x27;],
       [&#x27;1851-10-01T00:00:00.000000000&#x27;, &#x27;1851-11-01T00:00:00.000000000&#x27;],
       [&#x27;1851-11-01T00:00:00.000000000&#x27;, &#x27;1851-12-01T00:00:00.000000000&#x27;],
       [&#x27;1851-12-01T00:00:00.000000000&#x27;, &#x27;1852-01-01T00:00:00.000000000&#x27;],
       [&#x27;1852-01-01T00:00:00.000000000&#x27;, &#x27;1852-02-01T00:00:00.000000000&#x27;],
       [&#x27;1852-02-01T00:00:00.000000000&#x27;, &#x27;1852-03-01T00:00:00.000000000&#x27;],
       [&#x27;1852-03-01T00:00:00.000000000&#x27;, &#x27;1852-04-01T00:00:00.000000000&#x27;],
       [&#x27;1852-04-01T00:00:00.000000000&#x27;, &#x27;1852-05-01T00:00:00.000000000&#x27;],
       [&#x27;1852-05-01T00:00:00.000000000&#x27;, &#x27;1852-06-01T00:00:00.000000000&#x27;],
       [&#x27;1852-06-01T00:00:00.000000000&#x27;, &#x27;1852-07-01T00:00:00.000000000&#x27;],
       [&#x27;1852-07-01T00:00:00.000000000&#x27;, &#x27;1852-08-01T00:00:00.000000000&#x27;],
       [&#x27;1852-08-01T00:00:00.000000000&#x27;, &#x27;1852-09-01T00:00:00.000000000&#x27;],
       [&#x27;1852-09-01T00:00:00.000000000&#x27;, &#x27;1852-10-01T00:00:00.000000000&#x27;],
       [&#x27;1852-10-01T00:00:00.000000000&#x27;, &#x27;1852-11-01T00:00:00.000000000&#x27;],
       [&#x27;1852-11-01T00:00:00.000000000&#x27;, &#x27;1852-12-01T00:00:00.000000000&#x27;],
       [&#x27;1852-12-01T00:00:00.000000000&#x27;, &#x27;1853-01-01T00:00:00.000000000&#x27;],
       [&#x27;1853-01-01T00:00:00.000000000&#x27;, &#x27;1853-02-01T00:00:00.000000000&#x27;],
       [&#x27;1853-02-01T00:00:00.000000000&#x27;, &#x27;1853-03-01T00:00:00.000000000&#x27;],
       [&#x27;1853-03-01T00:00:00.000000000&#x27;, &#x27;1853-04-01T00:00:00.000000000&#x27;],
       [&#x27;1853-04-01T00:00:00.000000000&#x27;, &#x27;1853-05-01T00:00:00.000000000&#x27;],
       [&#x27;1853-05-01T00:00:00.000000000&#x27;, &#x27;1853-06-01T00:00:00.000000000&#x27;],
       [&#x27;1853-06-01T00:00:00.000000000&#x27;, &#x27;1853-07-01T00:00:00.000000000&#x27;],
       [&#x27;1853-07-01T00:00:00.000000000&#x27;, &#x27;1853-08-01T00:00:00.000000000&#x27;],
       [&#x27;1853-08-01T00:00:00.000000000&#x27;, &#x27;1853-09-01T00:00:00.000000000&#x27;],
       [&#x27;1853-09-01T00:00:00.000000000&#x27;, &#x27;1853-10-01T00:00:00.000000000&#x27;],
       [&#x27;1853-10-01T00:00:00.000000000&#x27;, &#x27;1853-11-01T00:00:00.000000000&#x27;],
       [&#x27;1853-11-01T00:00:00.000000000&#x27;, &#x27;1853-12-01T00:00:00.000000000&#x27;],
       [&#x27;1853-12-01T00:00:00.000000000&#x27;, &#x27;1854-01-01T00:00:00.000000000&#x27;],
       [&#x27;1854-01-01T00:00:00.000000000&#x27;, &#x27;1854-02-01T00:00:00.000000000&#x27;],
       [&#x27;1854-02-01T00:00:00.000000000&#x27;, &#x27;1854-03-01T00:00:00.000000000&#x27;],
       [&#x27;1854-03-01T00:00:00.000000000&#x27;, &#x27;1854-04-01T00:00:00.000000000&#x27;],
       [&#x27;1854-04-01T00:00:00.000000000&#x27;, &#x27;1854-05-01T00:00:00.000000000&#x27;],
       [&#x27;1854-05-01T00:00:00.000000000&#x27;, &#x27;1854-06-01T00:00:00.000000000&#x27;],
       [&#x27;1854-06-01T00:00:00.000000000&#x27;, &#x27;1854-07-01T00:00:00.000000000&#x27;],
       [&#x27;1854-07-01T00:00:00.000000000&#x27;, &#x27;1854-08-01T00:00:00.000000000&#x27;],
       [&#x27;1854-08-01T00:00:00.000000000&#x27;, &#x27;1854-09-01T00:00:00.000000000&#x27;],
       [&#x27;1854-09-01T00:00:00.000000000&#x27;, &#x27;1854-10-01T00:00:00.000000000&#x27;],
       [&#x27;1854-10-01T00:00:00.000000000&#x27;, &#x27;1854-11-01T00:00:00.000000000&#x27;],
       [&#x27;1854-11-01T00:00:00.000000000&#x27;, &#x27;1854-12-01T00:00:00.000000000&#x27;],
       [&#x27;1854-12-01T00:00:00.000000000&#x27;, &#x27;1855-01-01T00:00:00.000000000&#x27;]],
      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>vertices_latitude</span></div><div class='xr-var-dims'>(j, i, vertices)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-865d9c60-142e-40e8-b3bd-38deee212947' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-865d9c60-142e-40e8-b3bd-38deee212947' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-bb459284-4928-4bcd-a30c-210b5aa62c38' class='xr-var-data-in' type='checkbox'><label for='data-bb459284-4928-4bcd-a30c-210b5aa62c38' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degrees_north</dd></dl></div><div class='xr-var-data'><pre>[1286400 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>vertices_longitude</span></div><div class='xr-var-dims'>(j, i, vertices)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-f3551710-044e-443c-b579-c197c5983b95' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-f3551710-044e-443c-b579-c197c5983b95' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-c8999079-d9e1-4fd8-88f3-c0e4a928b352' class='xr-var-data-in' type='checkbox'><label for='data-c8999079-d9e1-4fd8-88f3-c0e4a928b352' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>units :</span></dt><dd>degrees_east</dd></dl></div><div class='xr-var-data'><pre>[1286400 values with dtype=float64]</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span>tos</span></div><div class='xr-var-dims'>(time, j, i)</div><div class='xr-var-dtype'>float32</div><div class='xr-var-preview xr-preview'>...</div><input id='attrs-557cedf6-b237-4a2e-bde8-e06199746f3f' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-557cedf6-b237-4a2e-bde8-e06199746f3f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-85faa325-e670-4fe5-848e-e9f8c232d64c' class='xr-var-data-in' type='checkbox'><label for='data-85faa325-e670-4fe5-848e-e9f8c232d64c' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>sea_surface_temperature</dd><dt><span>long_name :</span></dt><dd>Sea Surface Temperature</dd><dt><span>comment :</span></dt><dd>Temperature of upper boundary of the liquid ocean, including temperatures below sea-ice and floating ice shelves.</dd><dt><span>units :</span></dt><dd>degC</dd><dt><span>original_name :</span></dt><dd>tos</dd><dt><span>cell_methods :</span></dt><dd>area: mean where sea time: mean</dd><dt><span>cell_measures :</span></dt><dd>area: areacello</dd><dt><span>history :</span></dt><dd>2019-08-25T06:00:45Z altered by CMOR: replaced missing value flag (-9e+33) and corresponding data with standard missing value (1e+20).</dd></dl></div><div class='xr-var-data'><pre>[19296000 values with dtype=float32]</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-b5ff85f7-cc2e-4fcb-a760-b79b0c67a27f' class='xr-section-summary-in' type='checkbox'  ><label for='section-b5ff85f7-cc2e-4fcb-a760-b79b0c67a27f' class='xr-section-summary' >Attributes: <span>(47)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>Conventions :</span></dt><dd>CF-1.7 CMIP-6.2</dd><dt><span>activity_id :</span></dt><dd>CMIP</dd><dt><span>branch_method :</span></dt><dd>standard</dd><dt><span>branch_time_in_child :</span></dt><dd>0.0</dd><dt><span>branch_time_in_parent :</span></dt><dd>0.0</dd><dt><span>contact :</span></dt><dd>cmip6-mpi-esm@dkrz.de</dd><dt><span>creation_date :</span></dt><dd>2019-08-25T06:00:45Z</dd><dt><span>data_specs_version :</span></dt><dd>01.00.30</dd><dt><span>experiment :</span></dt><dd>all-forcing simulation of the recent past</dd><dt><span>experiment_id :</span></dt><dd>historical</dd><dt><span>external_variables :</span></dt><dd>areacello</dd><dt><span>forcing_index :</span></dt><dd>1</dd><dt><span>frequency :</span></dt><dd>mon</dd><dt><span>further_info_url :</span></dt><dd>https://furtherinfo.es-doc.org/CMIP6.MPI-M.MPI-ESM1-2-HR.historical.none.r1i1p1f1</dd><dt><span>grid :</span></dt><dd>gn</dd><dt><span>grid_label :</span></dt><dd>gn</dd><dt><span>history :</span></dt><dd>2019-08-25T06:00:45Z ; CMOR rewrote data to be consistent with CMIP6, CF-1.7 CMIP-6.2 and CF standards.</dd><dt><span>initialization_index :</span></dt><dd>1</dd><dt><span>institution :</span></dt><dd>Max Planck Institute for Meteorology, Hamburg 20146, Germany</dd><dt><span>institution_id :</span></dt><dd>MPI-M</dd><dt><span>mip_era :</span></dt><dd>CMIP6</dd><dt><span>nominal_resolution :</span></dt><dd>50 km</dd><dt><span>parent_activity_id :</span></dt><dd>CMIP</dd><dt><span>parent_experiment_id :</span></dt><dd>piControl</dd><dt><span>parent_mip_era :</span></dt><dd>CMIP6</dd><dt><span>parent_source_id :</span></dt><dd>MPI-ESM1-2-HR</dd><dt><span>parent_time_units :</span></dt><dd>days since 1850-1-1 00:00:00</dd><dt><span>parent_variant_label :</span></dt><dd>r1i1p1f1</dd><dt><span>physics_index :</span></dt><dd>1</dd><dt><span>product :</span></dt><dd>model-output</dd><dt><span>project_id :</span></dt><dd>CMIP6</dd><dt><span>realization_index :</span></dt><dd>1</dd><dt><span>realm :</span></dt><dd>ocean</dd><dt><span>references :</span></dt><dd>MPI-ESM: Mauritsen, T. et al. (2019), Developments in the MPI‐M Earth System Model version 1.2 (MPI‐ESM1.2) and Its Response to Increasing CO2, J. Adv. Model. Earth Syst.,11, 998-1038, doi:10.1029/2018MS001400,
Mueller, W.A. et al. (2018): A high‐resolution version of the Max Planck Institute Earth System Model MPI‐ESM1.2‐HR. J. Adv. Model. EarthSyst.,10,1383–1413, doi:10.1029/2017MS001217</dd><dt><span>source :</span></dt><dd>MPI-ESM1.2-HR (2017): 
aerosol: none, prescribed MACv2-SP
atmos: ECHAM6.3 (spectral T127; 384 x 192 longitude/latitude; 95 levels; top level 0.01 hPa)
atmosChem: none
land: JSBACH3.20
landIce: none/prescribed
ocean: MPIOM1.63 (tripolar TP04, approximately 0.4deg; 802 x 404 longitude/latitude; 40 levels; top grid cell 0-12 m)
ocnBgchem: HAMOCC6
seaIce: unnamed (thermodynamic (Semtner zero-layer) dynamic (Hibler 79) sea ice model)</dd><dt><span>source_id :</span></dt><dd>MPI-ESM1-2-HR</dd><dt><span>source_type :</span></dt><dd>AOGCM</dd><dt><span>sub_experiment :</span></dt><dd>none</dd><dt><span>sub_experiment_id :</span></dt><dd>none</dd><dt><span>table_id :</span></dt><dd>Omon</dd><dt><span>table_info :</span></dt><dd>Creation Date:(09 May 2019) MD5:e6ef8ececc8f338646ebfb3aeed36bfc</dd><dt><span>title :</span></dt><dd>MPI-ESM1-2-HR output prepared for CMIP6</dd><dt><span>variable_id :</span></dt><dd>tos</dd><dt><span>variant_label :</span></dt><dd>r1i1p1f1</dd><dt><span>license :</span></dt><dd>CMIP6 model data produced by MPI-M is licensed under a Creative Commons Attribution ShareAlike 4.0 International License (https://creativecommons.org/licenses). Consult https://pcmdi.llnl.gov/CMIP6/TermsOfUse for terms of use governing CMIP6 output, including citation requirements and proper acknowledgment. Further information about this data, including some limitations, can be found via the further_info_url (recorded as a global attribute in this file) and. The data producers and data providers make no warranty, either express or implied, including, but not limited to, warranties of merchantability and fitness for a particular purpose. All liabilities arising from the supply of the information (including any liability arising in negligence) are excluded to the fullest extent permitted by law.</dd><dt><span>cmor_version :</span></dt><dd>3.5.0</dd><dt><span>tracking_id :</span></dt><dd>hdl:21.14100/ccd8388f-4f80-4a1e-ba47-66fe65bbeece</dd></dl></div></li></ul></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use cdo selindexbox,lon_idx1,lon_idx2,lat_idx1,lat_idx2 (indexing starts at 1!)</span>
<span class="c1">#  to remove halo and verifygrid to confirm duplicated and/or collapsing cells have been removed</span>
<span class="o">!</span> cdo verifygrid -selindexbox,2,801,3,404 <span class="o">{</span>path_tos<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">cdo(1) selindexbox: </span>Process started
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">cdo    verifygrid: </span><span class=" -Color -Color-Blue">Grid consists of 321600 (800x402) cells (type: curvilinear), of which</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">cdo    verifygrid: </span><span class=" -Color -Color-Blue">   321600 cells have 4 vertices</span>
<span class=" -Color -Color-Green">cdo    verifygrid: </span> longitude : 0.00591556 to 359.9989 degrees
<span class=" -Color -Color-Green">cdo    verifygrid: </span>  latitude : -78.71779 to 89.76312 degrees
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">cdo(1) selindexbox: </span>Processed 19440480 values from 1 variable over 60 timesteps.
<span class=" -Color -Color-Green">cdo    verifygrid: </span>Processed 1 variable [0.55s 321MB].
</pre></div>
</div>
</div>
</div>
<p>Now one can remap the global dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create global target grid</span>
<span class="n">ds_out_global</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">grid_global</span><span class="p">(</span><span class="n">d_lat</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d_lon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the remapping weights (taking a while to calculate)</span>
<span class="c1">#  for global datasets, we need to set the periodic parameter, or we might get missing values</span>
<span class="c1">#  contaminating the result where the east and west edges of the grid meet, or at the poles.</span>
<span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">method_list</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">method</span><span class="p">)</span>
    <span class="o">%</span><span class="k">time</span> regridder[method+&quot;_tos_global&quot;] = xe.Regridder(ds_tos_nohalo, ds_out_global, method, periodic=True)
    <span class="c1">#In case one wants to see the halo effects:</span>
    <span class="c1">#regridder[method+&quot;_tos_global&quot;] = xe.Regridder(ds_tos_global, ds_out_global, method, periodic=True, ignore_degenerate=True)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>bilinear
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/work/bm0021/conda-envs-public/summerschool_2022/lib/python3.10/site-packages/xesmf/backend.py:38: UserWarning: Input array is not F_CONTIGUOUS. Will affect performance.
  warnings.warn(&#39;Input array is not F_CONTIGUOUS. &#39; &#39;Will affect performance.&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 11 s, sys: 550 ms, total: 11.6 s
Wall time: 11.7 s

conservative
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 7.01 s, sys: 65.5 ms, total: 7.08 s
Wall time: 7.12 s

conservative_normed
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 6.89 s, sys: 77 ms, total: 6.97 s
Wall time: 7.01 s

patch
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 2min 54s, sys: 1.02 s, total: 2min 55s
Wall time: 2min 56s

nearest_s2d
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 705 ms, sys: 1.11 ms, total: 706 ms
Wall time: 720 ms

nearest_d2s
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CPU times: user 1.11 s, sys: 955 µs, total: 1.11 s
Wall time: 1.11 s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Conduct the remapping</span>
<span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">method_list</span><span class="p">:</span>
    <span class="n">ds_out_global</span><span class="p">[</span><span class="n">method</span><span class="o">+</span><span class="s2">&quot;_tos_global_skipna&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regridder</span><span class="p">[</span><span class="n">method</span><span class="o">+</span><span class="s2">&quot;_tos_global&quot;</span><span class="p">](</span><span class="n">ds_tos_nohalo</span><span class="o">.</span><span class="n">tos</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">na_thres</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="c1"># In case one wants to see the halo effects (the proper weights must have been generated in the cell above):</span>
    <span class="c1">#ds_out_global[method+&quot;_tos_global_skipna&quot;] = regridder[method+&quot;_tos_global&quot;](ds_tos_global.tos.isel(time=0), skipna=True, na_thres=0.3)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">method_list</span><span class="p">):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ds_out_global</span><span class="p">[</span><span class="n">method</span><span class="o">+</span><span class="s2">&quot;_tos_global_skipna&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/Regrid_xESMF_39_0.png" src="_images/Regrid_xESMF_39_0.png" />
</div>
</div>
</section>
<section id="more-examples">
<h2>More Examples<a class="headerlink" href="#more-examples" title="Permalink to this headline">#</a></h2>
<p>For more examples see:</p>
<ul class="simple">
<li><p>the extensive <a class="reference external" href="https://xesmf.readthedocs.io/en/latest/">xESMF documentation</a></p></li>
<li><p>this selection of jupyter notebooks:</p>
<ul>
<li><p><a class="reference external" href="https://nbviewer.jupyter.org/github/Ouranosinc/pavics-sdi/blob/master/docs/source/notebooks/regridding.ipynb">Remapping climate data with xESMF</a> provided by <a class="reference external" href="https://www.ouranos.ca/en/">Ouranos</a></p></li>
<li><p><a class="reference external" href="https://earth-env-data-science.github.io/lectures/working_with_gcm_data.html">Working with GCM data</a></p></li>
<li><p><a class="reference external" href="https://nbviewer.org/github/roocs/regrid-prototype/blob/main/docs/notebooks/xESMF_curvilinear_nearest_mask_unmapped.ipynb">Remapping regional datasets</a></p></li>
<li><p><a class="reference external" href="https://nbviewer.org/github/roocs/regrid-prototype/blob/main/docs/notebooks/xESMF_unstructured_locstream_ref.ipynb">Remapping from unstructured grids</a></p></li>
<li><p><a class="reference external" href="https://nbviewer.org/github/roocs/clisops/blob/regrid-main/notebooks/regrid.ipynb">Regridding with clisops powered by xESMF</a></p></li>
<li><p><a class="reference external" href="https://nbviewer.jupyter.org/github/roocs/regrid-prototype/blob/main/docs/notebooks/xESMF_Behaviour_Halo.ipynb">Pitfall grid halos when remapping</a></p></li>
</ul>
</li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "cehbrecht/jupyter-guide-to-climate-data",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "summerschool_2022"
        },
        kernelOptions: {
            kernelName: "summerschool_2022",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'summerschool_2022'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="xarray.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">xarray</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="esgf-subset-cmip6.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">ESGF: Subset CMIP6 Datasets</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By DKRZ<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>